{"C:\\Users\\jclem\\Projects\\@fastify-typeorm-plugin\\src\\index.ts":{"path":"C:\\Users\\jclem\\Projects\\@fastify-typeorm-plugin\\src\\index.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":16},"end":{"line":3,"column":32}},"2":{"start":{"line":4,"column":25},"end":{"line":4,"column":75}},"3":{"start":{"line":5,"column":18},"end":{"line":5,"column":36}},"4":{"start":{"line":6,"column":20},"end":{"line":21,"column":1}},"5":{"start":{"line":8,"column":4},"end":{"line":13,"column":5}},"6":{"start":{"line":9,"column":8},"end":{"line":9,"column":40}},"7":{"start":{"line":12,"column":8},"end":{"line":12,"column":55}},"8":{"start":{"line":14,"column":4},"end":{"line":14,"column":34}},"9":{"start":{"line":15,"column":4},"end":{"line":15,"column":40}},"10":{"start":{"line":16,"column":4},"end":{"line":19,"column":7}},"11":{"start":{"line":17,"column":8},"end":{"line":17,"column":44}},"12":{"start":{"line":18,"column":8},"end":{"line":18,"column":15}},"13":{"start":{"line":20,"column":4},"end":{"line":20,"column":29}},"14":{"start":{"line":22,"column":0},"end":{"line":25,"column":3}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":20},"end":{"line":6,"column":21}},"loc":{"start":{"line":6,"column":48},"end":{"line":21,"column":1}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":31},"end":{"line":16,"column":32}},"loc":{"start":{"line":16,"column":64},"end":{"line":19,"column":5}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":4},"end":{"line":13,"column":5}},"type":"if","locations":[{"start":{"line":8,"column":4},"end":{"line":13,"column":5}},{"start":{"line":8,"column":4},"end":{"line":13,"column":5}}],"line":8}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":3,"6":1,"7":2,"8":3,"9":2,"10":2,"11":2,"12":2,"13":2,"14":1},"f":{"0":3,"1":2},"b":{"0":[1,2]},"inputSourceMap":{"version":3,"file":"file:///C:/Users/jclem/Projects/@fastify-typeorm-plugin/src/index.ts","sources":["file:///C:/Users/jclem/Projects/@fastify-typeorm-plugin/src/index.ts"],"names":[],"mappings":";;;AACA,4EAAgC;AAChC,qCAAwD;AAYxD,MAAM,WAAW,GAAwC,KAAK,EAC7D,OAAO,EACP,OAAO,EACN,EAAE;IACH,IAAI,UAAsB,CAAC;IAE3B,IAAI,OAAO,CAAC,UAAU,EAAE;QACvB,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC;KAChC;SAAM;QACN,UAAU,GAAG,IAAI,oBAAU,CAAC,OAA4B,CAAC,CAAC;KAC1D;IAED,MAAM,UAAU,CAAC,UAAU,EAAE,CAAC;IAC9B,OAAO,CAAC,QAAQ,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;IACpC,OAAO,CAAC,OAAO,CAAC,SAAS,EAAE,KAAK,EAAE,eAAe,EAAE,IAAI,EAAE,EAAE;QAC1D,MAAM,eAAe,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;QACpC,IAAI,EAAE,CAAC;IACR,CAAC,CAAC,CAAC;IAEH,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;AAC1B,CAAC,CAAC;AAEF,kBAAe,IAAA,wBAAE,EAAC,WAAW,EAAE;IAC9B,OAAO,EAAE,KAAK;IACd,IAAI,EAAE,kBAAkB;CACxB,CAAC,CAAC","sourcesContent":["import { FastifyPluginAsync } from 'fastify';\nimport fp from 'fastify-plugin';\nimport { DataSource, DataSourceOptions } from 'typeorm';\n\ndeclare module 'fastify' {\n\tinterface FastifyInstance {\n\t\torm: DataSource;\n\t}\n}\n\ntype DBConfigOptions = {\n\tconnection?: DataSource;\n} & Partial<DataSourceOptions>;\n\nconst pluginAsync: FastifyPluginAsync<DBConfigOptions> = async (\n\tfastify,\n\toptions\n) => {\n\tlet connection: DataSource;\n\n\tif (options.connection) {\n\t\tconnection = options.connection;\n\t} else {\n\t\tconnection = new DataSource(options as DataSourceOptions);\n\t}\n\n\tawait connection.initialize();\n\tfastify.decorate('orm', connection);\n\tfastify.addHook('onClose', async (fastifyInstance, done) => {\n\t\tawait fastifyInstance.orm.destroy();\n\t\tdone();\n\t});\n\n\treturn Promise.resolve();\n};\n\nexport default fp(pluginAsync, {\n\tfastify: '4.x',\n\tname: '@fastify-typeorm',\n});\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"118fd8590c073adc7bfb1fafc2b7332928ff36c0","contentHash":"7c5762f8af7dda934178acaba4f6e41299e1753f02021a632bad41a9912156c2"}}